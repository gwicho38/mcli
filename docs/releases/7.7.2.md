# Release 7.7.2

**Release Date**: 2025-10-15

## Summary

This is a critical hotfix release that fixes two major bugs in version 7.7.1 that prevented core functionality from working correctly.

## What Changed from 7.7.1

### Bug Fixes

#### 1. Fixed NameError in `mcli self update` Command

**Issue:**
- `mcli self update` crashed with `NameError: name 'tmp_path' is not defined`
- Command was completely non-functional in 7.7.1

**Root Cause:**
- Orphaned code block (lines 1246-1272) was incorrectly placed in the `update()` function's exception handler
- Code referenced undefined variables: `tmp_path`, `new_code`, `command_data`, `command_file`, `manager`
- Appeared to be leftover code from a different function (possibly an edit command)

**Solution:**
- Removed the orphaned code block
- Properly closed the exception handler
- Clean error handling without undefined variable references

**Testing:**
```bash
mcli self update --check
# ✅ Now works without NameError
```

**File:** `src/mcli/self/self_cmd.py`
**Commit:** `8698113`

---

#### 2. Fixed Package Metadata Not Found in `mcli version` Command

**Issue:**
- `mcli version` failed with: "Could not determine version: No package metadata was found for mcli"
- Affected all PyPI installations and uv tool installations
- Only worked in local development environments

**Root Cause:**
- Version detection hardcoded to look for package name `"mcli"`
- Actual PyPI package name is `"mcli-framework"`
- `get_version_info()` only checked metadata under `"mcli"`

**Solution:**
- Try `"mcli-framework"` first (PyPI installations)
- Fall back to `"mcli"` (local development installations)
- Return clear error message if neither is found

**Testing:**
```bash
mcli version
# ✅ Now correctly shows: "mcli version 7.7.2"

mcli version --verbose
# ✅ Shows version, Python, platform, description, author
```

**File:** `src/mcli/app/main.py`
**Commit:** `73051b0`

---

## Technical Details

### Version Detection Logic

**Before (7.7.1):**
```python
def get_version_info(verbose: bool = False) -> str:
    try:
        mcli_version = version("mcli")  # ❌ Wrong package name
        meta = metadata("mcli")          # ❌ Wrong package name
        # ...
```

**After (7.7.2):**
```python
def get_version_info(verbose: bool = False) -> str:
    try:
        # Try mcli-framework first (PyPI package name), then mcli (local dev)
        mcli_version = None
        meta = None

        for pkg_name in ["mcli-framework", "mcli"]:
            try:
                mcli_version = version(pkg_name)
                meta = metadata(pkg_name)
                break
            except Exception:
                continue
        # ✅ Works for both PyPI and local dev
```

### Update Command Exception Handling

**Before (7.7.1):**
```python
    except Exception as e:
        console.print(f"[red]❌ Error during update: {e}[/red]")
        # ... traceback ...

        # ❌ Orphaned code from different function
        compile(new_code, "<string>", "exec")  # new_code undefined
        command_data["code"] = new_code        # command_data undefined
        Path(tmp_path).unlink(missing_ok=True) # tmp_path undefined ← CRASH
```

**After (7.7.2):**
```python
    except Exception as e:
        console.print(f"[red]❌ Error during update: {e}[/red]")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/dim]")
    # ✅ Clean exception handling, no undefined variables
```

---

## Installation & Upgrade

### From PyPI (Recommended)

```bash
# Upgrade to 7.7.2
pip install --upgrade mcli-framework

# Or with UV
uv pip install --upgrade mcli-framework
uv tool install mcli-framework --force
```

### From Source

```bash
git clone https://github.com/gwicho38/mcli.git
cd mcli
git checkout v7.7.2
uv pip install -e .
```

---

## Testing & Verification

All bugs have been verified as fixed:

### Test 1: Version Command
```bash
$ mcli version
╭──────────────────────────────────────────────────────────────╮
│ ℹ️  mcli version 7.7.2                                        │
╰──────────────────────────────────────────────────────────────╯

✅ PASS: No "package metadata not found" error
```

### Test 2: Update Command
```bash
$ mcli self update --check
Current version: 7.7.2
Checking PyPI for updates...
Latest version: 7.7.2
✅ You're already on the latest version!

✅ PASS: No NameError, clean execution
```

### Test 3: Version Detection in Both Environments
```bash
# PyPI installation
$ uv tool install mcli-framework --force
$ mcli version
✅ mcli version 7.7.2

# Local development
$ cd mcli-repo
$ uv run mcli version
✅ mcli version 7.7.2
```

---

## Breaking Changes

**None.** This is a pure bugfix release with no breaking changes.

---

## Known Issues

None at this time. All critical bugs from 7.7.1 have been resolved.

---

## Migration from 7.7.1

No migration needed. Simply upgrade:

```bash
# If using pip
pip install --upgrade mcli-framework

# If using uv tool
uv tool install mcli-framework --force

# If using uv pip
uv pip install --upgrade mcli-framework
```

---

## Contributors

- MCLI Development Team

---

## Related Issues

- Resolves: NameError in `mcli self update` (issue #1)
- Resolves: Package metadata not found in `mcli version` (issue #2)
- Fixes: Version 7.7.1 had broken core commands

---

## Comparison with 7.7.1

| Feature | 7.7.1 | 7.7.2 |
|---------|-------|-------|
| `mcli version` | ❌ Broken (metadata not found) | ✅ Fixed |
| `mcli self update` | ❌ Broken (NameError crash) | ✅ Fixed |
| Android SDK emulator | ✅ Working | ✅ Working |
| iOS simulator | ✅ Working | ✅ Working |
| Documentation | ✅ Organized | ✅ Organized |

---

## Why This Release?

Version 7.7.1 was published to PyPI but had two critical bugs that made core functionality unusable:
1. Users couldn't check their version
2. Users couldn't update to new versions

This release (7.7.2) fixes both issues immediately.

---

**Full Changelog**: 7.7.1...7.7.2

**Git Tag**: `v7.7.2`
**Commits Since 7.7.1**: 3
- `e3e0fb9` - docs: Reorganize top-level documentation into docs/ subdirectories
- `8698113` - fix: Remove orphaned code causing NameError in mcli self update
- `73051b0` - fix: Version command now correctly detects mcli-framework package
