# Release Notes - Version 7.9.6

## Improvements

### XeLaTeX Engine for Unicode Support

The doc-convert workflow now uses **XeLaTeX** as the default PDF engine for all conversions, replacing pdflatex. This change provides:

- **Better Unicode Support**: Handles emojis, special characters, and international text
- **Improved Success Rate**: 100% conversion success for 23 test documents
- **Fallback Compatibility**: All 4-tier fallback strategies now support Unicode

#### What This Means

Documents that previously failed with errors like:
```
! LaTeX Error: Unicode character ⭐ (U+2B50) not set up for use with LaTeX
```

Now convert successfully with only warnings (which can be safely ignored).

### New Cleanup Command

Added `mcli workflow doc-convert cleanup` command for safe dependency removal:

**Features:**
- Generates reviewable shell script at `~/.mcli/commands/doc-convert-cleanup.sh`
- Interactive confirmation before uninstalling
- Removes all doc-convert dependencies:
  - pandoc (universal document converter)
  - basictex (LaTeX distribution)
  - jupyter & nbconvert (Jupyter tools)
  - LaTeX packages (collection-latexextra, collection-fontsrecommended)
- Warnings about shared dependencies
- Optional temp directory cleanup

**Usage:**
```bash
# Generate cleanup script
mcli workflow doc-convert cleanup

# Review the script
cat ~/.mcli/commands/doc-convert-cleanup.sh

# Run cleanup (with confirmation)
bash ~/.mcli/commands/doc-convert-cleanup.sh
```

## Technical Details

### Files Modified

**src/mcli/workflow/doc_convert.py:**
- Line 266: Changed `--pdf-engine=pdflatex` → `--pdf-engine=xelatex`
- Lines 329-331: Added XeLaTeX engine for standard pandoc conversions
- Lines 666-784: Implemented `cleanup()` command with script generation
- Lines 479, 498-505: Updated init command documentation

### Conversion Strategy Changes

All PDF conversion methods now use XeLaTeX:

1. **jupyter nbconvert** (Method 1): Uses XeLaTeX internally
2. **pandoc with LaTeX** (Method 2): `--pdf-engine=xelatex`
3. **pandoc HTML intermediate** (Method 3): `--pdf-engine=xelatex`
4. **pandoc default** (Method 4): `--pdf-engine=xelatex`

### Testing Results

Validated with real-world documents from UIUC courses:

**Test Dataset:**
- 20 Jupyter notebooks (.ipynb)
- 3 HTML files
- Various content types: code, math, Unicode characters, emojis

**Results:**
- ✅ 23/23 files converted successfully (100% success rate)
- ✅ Handles Unicode/emoji characters in markdown cells
- ✅ Processes complex LaTeX math formulas
- ✅ Fallback strategies work reliably

**Courses Tested:**
- CS598DLH (Deep Learning for Healthcare): 14 notebooks
- CS598PSL (Practical Statistical Learning): 2 HTML files, 7 notebooks

## Migration Notes

### For Existing Users

No breaking changes. The switch to XeLaTeX is transparent:

- Existing commands work without modification
- Documents that worked before continue to work
- Documents that failed due to Unicode now succeed
- Performance is similar to pdflatex

### Known Limitations

**Font Warnings:**
You may see warnings like:
```
[WARNING] Missing character: There is no ⭐ (U+2B50) in font [lmroman10-regular]
```

These are **safe to ignore**. The PDF is still generated correctly; the character may just appear as a different symbol or be omitted.

**Workaround:**
If you need perfect Unicode rendering, consider:
1. Converting to HTML first (always works)
2. Using a browser to print HTML to PDF
3. Installing additional Unicode fonts in LaTeX

## Usage Examples

```bash
# Convert Jupyter notebook with Unicode/emojis
mcli workflow doc-convert convert ipynb pdf notebook_with_emojis.ipynb

# Convert HTML with special characters
mcli workflow doc-convert convert html pdf document_with_unicode.html

# Batch convert all notebooks in a directory
mcli workflow doc-convert convert ipynb pdf "notebooks/**/*.ipynb"

# Generate cleanup script for later uninstall
mcli workflow doc-convert cleanup
```

## Cleanup Command Details

The cleanup script removes:

1. **Homebrew Packages:**
   - pandoc
   - basictex (cask)

2. **LaTeX Distribution:**
   - /usr/local/texlive/2025basic/ directory

3. **Python Packages:**
   - jupyter
   - jupyter-core
   - jupyterlab
   - nbconvert

4. **Optional:**
   - ~/.mcli/commands/temp/ (temp conversion directory)

## Contributors

- Luis Fernandez de la Vara

## Links

- GitHub: https://github.com/gwicho38/mcli
- PyPI: https://pypi.org/project/mcli-framework/
- Docs: https://github.com/gwicho38/mcli/tree/main/docs
