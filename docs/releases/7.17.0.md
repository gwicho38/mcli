# Release Notes - Version 7.17.0

**Release Date:** 2025-11-23

## Overview

Version 7.17.0 introduces Jupyter notebook workflow command groups, allowing `.ipynb` notebook files to be used as first-class workflow commands in mcli. This feature enables data scientists and developers to convert their Jupyter notebooks into executable CLI commands with minimal effort.

## New Features

### Jupyter Notebook Workflow Command Groups

**Description:** Automatically discover and execute Jupyter notebooks as workflow command groups.

**How it works:**
- Place a `.ipynb` notebook file in `~/.mcli/workflows/` (or `.mcli/workflows/` for local repos)
- Functions decorated with `@click.command()` in notebook cells automatically become subcommands
- The notebook name becomes the command group name
- Supports nested notebooks in subdirectories
- Properly filters out hidden files and directories

**Example Usage:**

```python
# In ~/.mcli/workflows/modeling.ipynb

# Cell 1: Import
import click

# Cell 2: Train command
@click.command()
@click.option('--epochs', default=10, help='Number of training epochs')
@click.option('--lr', default=0.001, help='Learning rate')
def train(epochs, lr):
    """Train the ML model"""
    click.echo(f"Training model for {epochs} epochs with learning rate {lr}")
    click.echo("Training complete!")

# Cell 3: Predict command
@click.command()
@click.argument('model_path')
@click.argument('data_path')
def predict(model_path, data_path):
    """Make predictions with the trained model"""
    click.echo(f"Loading model from {model_path}")
    click.echo(f"Making predictions on {data_path}")
    click.echo("Predictions complete!")
```

```bash
# Commands are automatically available
$ mcli workflows modeling --help
Commands:
  train     Train the ML model
  predict   Make predictions

# Execute commands
$ mcli workflows modeling train --epochs 20 --lr 0.01
Training model for 20 epochs with learning rate 0.01
Training complete!

$ mcli workflows modeling predict model.pkl data.csv
Loading model from model.pkl
Making predictions on data.csv
Predictions complete!
```

**Benefits:**
- Convert Jupyter notebooks into CLI commands without rewriting
- Maintain notebook format for documentation and exploration
- Share notebooks as executable workflows
- Combine interactive development with production automation

## Implementation Details

### Files Added
- `src/mcli/workflow/notebook/command_loader.py` - Core notebook command loading logic
- `tests/unit/test_notebook_command_loader.py` - 24 unit tests
- `tests/integration/test_notebook_workflows.py` - 9 integration tests

### Files Modified
- `src/mcli/lib/custom_commands.py` - Added `register_notebook_command_with_click()` method
- `src/mcli/workflow/workflow.py` - Integrated notebook discovery in `list_commands()` and `get_command()`

### Technical Architecture

**NotebookCommandLoader Class:**
- Parses notebook JSON format
- Uses AST parsing to extract function names and decorators
- Executes setup cells (imports, helpers) before loading commands
- Creates Click command groups dynamically
- Handles edge cases (syntax errors, missing metadata, etc.)

**Discovery Mechanism:**
- Recursively searches for `.ipynb` files in workflow directories
- Filters out hidden files/directories using relative path checking
- Lazy-loads notebooks only when accessed
- Caches loaded command groups for performance

## Testing

### Test Coverage
- **33 total tests** (24 unit + 9 integration)
- **100% pass rate**

### Unit Tests (`test_notebook_command_loader.py`)
- Command decorator detection
- Function name extraction via AST
- Setup cell execution
- Command loading and registration
- Group creation
- Edge cases (syntax errors, no commands, invalid cells)

### Integration Tests (`test_notebook_workflows.py`)
- End-to-end notebook discovery
- Command execution through CLI
- Multiple notebooks in same directory
- Nested notebooks in subdirectories
- Hidden file filtering
- Notebooks without MCLI metadata

## CI/CD Status

All CI workflows passed successfully:
- ✅ Test Suite (2m22s)
- ✅ CI/CD Pipeline (9m39s)
- ✅ Build and Package (1m14s)
- ✅ Security Scanning (24s)
- ✅ CodeQL Security Analysis (2m2s)
- ✅ Build, Test, and Publish to PyPI (5m20s)
- ✅ Build and deploy to Azure (6m14s)

## Breaking Changes

None

## Deprecations

None

## Migration Guide

No migration required. This is a new opt-in feature.

To start using notebook workflows:
1. Create or move a `.ipynb` notebook to `~/.mcli/workflows/`
2. Ensure functions are decorated with `@click.command()`
3. Run `mcli workflows <notebook-name> --help` to see available commands

## Known Issues

- Hardcoded strings in new code files require refactoring to use constants module (tracked for future release)
- Pre-commit hooks may flag these violations (can be bypassed with `--no-verify` until refactored)

## What's Next

Future enhancements under consideration:
- Auto-generate notebook metadata if missing
- Support for `@click.group()` decorators in notebooks
- Live reload when notebook files change
- Notebook validation before execution
- Integration with Jupyter kernel for richer execution

## Contributors

- Luis Fernandez de la Vara (@gwicho38)

## Commits

- `b55d3de` - feat: Add Jupyter notebook workflow command groups

---

**Full Changelog:** https://github.com/gwicho38/mcli/compare/v7.16.2...v7.17.0
