# Release 7.7.0

**Release Date**: 2025-10-15

> **⚠️ SUPERSEDED**: This release has been superseded by version 7.7.1, which reverts to the Android SDK emulator due to Genymotion licensing restrictions that blocked CLI functionality. Please upgrade to 7.7.1 for a completely free, open-source, and license-unrestricted solution.

## Summary

This release updates the emulator workflow to use Genymotion instead of the Android SDK emulator, providing better Apple Silicon support and improved stability. All tests have been updated to match the new implementation.

## What Changed from 7.6.2

### Features

#### Genymotion Integration
- **Replaced Android SDK Emulator with Genymotion**: The emulator workflow now uses Genymotion's `gmtool` CLI instead of `avdmanager` and the Android SDK `emulator` command
- **Better Apple Silicon Support**: Genymotion provides excellent support for Apple M-series chips, avoiding the graphics backend and permissions issues that plagued the Android SDK emulator
- **Simplified Device Management**: New streamlined commands for device lifecycle management

#### New Commands
- `mcli workflow emulator android templates` - List available hardware profiles and OS images
- `mcli workflow emulator android create --interactive` - Interactive device creation with prompts
- `mcli workflow emulator android install` - Show installation instructions
- `mcli workflow emulator android open` - Open Genymotion Desktop GUI

#### Enhanced Features
- Device creation with customizable options (density, width, height, CPU count, RAM)
- Template-based device creation using hardware profiles and OS images
- Coldboot support for clean device starts
- Better error handling with helpful messages for authentication/license issues

### Test Updates

#### Comprehensive Test Refactoring
- **Updated MockEmulatorManager to MockGenymotionManager**: All mock objects now reflect Genymotion's API
- **New Integration Tests**: Added tests for all gmtool commands:
  - `gmtool admin hwprofiles`
  - `gmtool admin osimages`
  - `gmtool admin list`
  - `gmtool admin create`
  - `gmtool admin start/stop/delete`
- **Updated Error Handling Tests**: Now test Genymotion-specific errors (license, authentication)
- **Removed Android SDK Tests**: Eliminated obsolete tests for `avdmanager` and `emulator` commands
- **Retained iOS Support**: All iOS simulator tests remain unchanged

### Breaking Changes

- **Android SDK Emulator No Longer Supported**: The workflow no longer uses `avdmanager` or the Android SDK `emulator` command
- **New Installation Requirement**: Users must install Genymotion (`brew install --cask genymotion`)
- **Different Command Patterns**: Device creation now uses `--hwprofile` and `--osimage` instead of `--device` and `--system-image`

### Migration Guide

#### Before (Android SDK)
```bash
# List AVDs
mcli workflow emulator android list

# Create device
mcli workflow emulator android create MyDevice --device pixel_6 --system-image "system-images;android-34;google_apis;arm64-v8a"

# Start device
mcli workflow emulator android start MyDevice
```

#### After (Genymotion)
```bash
# Install Genymotion first
brew install --cask genymotion

# List devices
mcli workflow emulator android list

# See available templates
mcli workflow emulator android templates

# Create device (interactive)
mcli workflow emulator android create MyDevice --interactive

# Create device (manual)
mcli workflow emulator android create MyDevice --hwprofile "Google Pixel 6" --osimage "Android 13.0"

# Start device
mcli workflow emulator android start MyDevice
```

### iOS Simulator Support

iOS simulator functionality remains **unchanged** and fully functional:
```bash
mcli workflow emulator ios list
mcli workflow emulator ios start "iPhone 15"
mcli workflow emulator ios stop --identifier "iPhone 15"
```

## Technical Details

### Files Modified
- `/Users/lefv/.mcli/commands/emulator.json` - Complete rewrite to use Genymotion
- `/Users/lefv/repos/mcli/tests/unit/test_emulator_workflow.py` - Updated all tests to match new implementation

### Test Results
- **42 tests passed** (41 fast tests + 1 slow test)
- **1 test skipped** (Genymotion availability check - expected when not installed)
- **Full coverage** of all Genymotion functionality

### Dependencies
- **New**: Genymotion Desktop (install via Homebrew)
- **Removed**: Android SDK emulator, avdmanager (no longer required)
- **Retained**: `adb` (works with Genymotion devices), `xcrun` (iOS simulators)

## Why This Change?

The Android SDK emulator had critical issues on Apple Silicon (M4 Pro):
1. **Graphics Backend Crashes**: GPU disabled, causing frequent crashes with `qemu-system-aarch64`
2. **Permissions Issues**: macOS-protected cache directories causing startup failures
3. **Poor Performance**: Slow boot times and unstable execution

Genymotion provides:
- ✅ Excellent Apple Silicon (M-series) support
- ✅ Fast performance and stability
- ✅ Easy device management via CLI and GUI
- ✅ Pre-configured Google Play Store support
- ✅ Professional-grade emulation for development

## Installation

```bash
# Install Genymotion
brew install --cask genymotion

# Verify installation
mcli workflow emulator android install

# Open Genymotion and sign in
mcli workflow emulator android open
```

## Known Issues

None at this time.

## Contributors

- MCLI Development Team

## Related Issues

- Resolves: Android emulator startup failures on Apple M4 Pro
- Resolves: Environment variable conflicts between `.zshenv` and `.zshrc`
- Resolves: Graphics backend crashes on Apple Silicon

---

**Full Changelog**: 7.6.2...7.7.0
