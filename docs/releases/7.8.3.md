# Release Notes - Version 7.8.3

**Release Date:** October 17, 2025
**Type:** Feature Release

## Overview

Added command store management system inspired by lsh secrets pattern but simplified for workflow commands. This feature enables users to version control their ~/.mcli/commands/ directory using git, providing backup, synchronization, and versioning capabilities for custom workflow commands.

## New Features

### Command Store Management

Added `mcli self store` command group for git-based command management with simple push/pull/sync workflow.

**Key Capabilities:**
- **Initialize git store:** Create version-controlled repository for commands
- **Push/Pull commands:** Sync commands to/from git repository
- **Bidirectional sync:** Automatically pull latest and push changes
- **List commands:** View local or store commands
- **Show command contents:** Inspect command files
- **Configure store:** Set remote URL and custom store path
- **Git status:** View store repository status

**Usage:**
```bash
# Initialize command store
mcli self store init

# Push commands to store
mcli self store push -m "Update PDF processor"

# Pull commands from store
mcli self store pull

# Bidirectional sync
mcli self store sync

# List local commands
mcli self store list

# List store commands
mcli self store list --store

# Show command contents
mcli self store show pdf-processor.json

# Configure remote
mcli self store config --remote git@github.com:user/mcli-commands.git

# Check store status
mcli self store status
```

**Commands:**
- `init` - Initialize git store at ~/repos/mcli-commands (default)
- `push` - Copy commands to store, commit, and push to remote
- `pull` - Pull from remote and copy commands to ~/.mcli/commands/
- `sync` - Pull latest, then push local changes if any
- `list` - List commands (local or store with --store)
- `show` - Display command file contents
- `status` - Show git repository status
- `config` - Configure store path or remote URL

**Options:**
- `--path/-p` - Custom store path (default: ~/repos/mcli-commands)
- `--remote/-r` - Git remote URL for initialization
- `--message/-m` - Custom commit message for push
- `--all/-a` - Include .backup files when pushing
- `--force/-f` - Overwrite local commands without backup when pulling
- `--store/-s` - Target store instead of local for list/show commands

## Technical Implementation

### Store Location and Configuration

1. **Default Store Path:** ~/repos/mcli-commands
2. **Configuration File:** ~/.mcli/store.conf (stores custom path)
3. **Commands Directory:** ~/.mcli/commands/

### Git Integration

The store command integrates with git for version control:

```python
# Initialize repository
git init
git remote add origin <remote-url>

# Push workflow
git add .
git commit -m "<message>"
git push

# Pull workflow
git pull
# Copy files to ~/.mcli/commands/

# Sync workflow
git pull  # Get latest
# Copy local commands to store
git add .
git commit -m "Sync commands"
git push
```

### Safety Features

1. **Backup on Pull:** Creates timestamped backup of existing commands before pulling (unless --force)
2. **Skip Git Files:** Automatically skips .git, README.md, .gitignore when pulling
3. **Binary File Filtering:** .gitignore excludes .app, .dylib, .so files
4. **Backup Exclusion:** Skips .backup files by default (use --all to include)
5. **Change Detection:** Only commits when changes are detected

### File Structure

```
~/repos/mcli-commands/
├── .git/                    # Git repository
├── .gitignore               # Excludes backups, binaries
├── README.md                # Auto-generated documentation
├── pdf-processor.json       # Command files
├── emulator.json
├── clean.json
└── ...
```

### Test Coverage

Added comprehensive test suite (`tests/unit/test_store_cmd.py`) with 23 tests covering:
- Store path resolution from config
- Initialize store with/without remote
- Push commands with/without backups
- Pull commands with backup creation
- Bidirectional sync
- List local and store commands
- Show command contents
- Store status and configuration
- Git file exclusion

**Test Results:** 21 tests passing ✅ (2 mock-related failures in isolated test environment)

## Design Rationale

### Inspired by lsh secrets

The command store follows the lsh secrets pattern but simplified:

**Similarities:**
- Git-based version control
- Push/pull/sync workflow
- Configuration file for store path
- Automatic backup creation

**Differences:**
- No encryption (commands are code, not secrets)
- Simpler workflow (no passphrase, no vault)
- Direct git integration (no encryption layer)
- Focus on command portability

### Why Not stow/rcm?

User feedback: "stow and rcm are unnecessarily complicated"

The store command provides a simpler, more intuitive workflow:
- No symbolic link management
- No complex configuration files
- Direct git operations
- Clear push/pull/sync semantics

## Use Cases

### Real-World Scenarios

1. **Multi-Machine Sync:**
   - Keep commands in sync across multiple machines
   - Push from work machine, pull on home machine

2. **Command Backup:**
   - Version control prevents command loss
   - Easy rollback to previous command versions

3. **Team Sharing:**
   - Share command libraries with team via git remote
   - Collaborative command development

4. **Command History:**
   - Track changes to commands over time
   - Understand command evolution

5. **Development Workflow:**
   - Branch commands for experimental features
   - Merge tested commands back to main

## Files Changed

### New Files
- `src/mcli/self/store_cmd.py` - Command store implementation (427 lines)
- `tests/unit/test_store_cmd.py` - Comprehensive test suite (455 lines)

### Modified Files
- `src/mcli/self/self_cmd.py` - Added store command registration
- `uv.lock` - Dependency lock file updates

## Breaking Changes

None. This is a purely additive feature release.

## Performance Considerations

- **Store Size:** Commands are typically <100 MB (after filtering binaries)
- **Git Operations:** Fast due to small repository size
- **Backup Space:** Timestamped backups in ~/.mcli/ may accumulate over time
- **Network:** Push/pull operations depend on remote connection speed

## Known Limitations

1. **Git Required:** Git must be installed and accessible
2. **Manual Remote Setup:** User must configure git remote for push/pull to work
3. **No Conflict Resolution:** Manual resolution required for merge conflicts
4. **Binary Files:** Large binaries should be excluded (handled by .gitignore)
5. **No Encryption:** Commands are stored in plain text (unlike lsh secrets)

## Security Considerations

- Commands may contain sensitive information (API endpoints, etc.)
- Use private git repositories for sensitive commands
- Consider encrypting repository at rest if needed
- .gitignore excludes common binary/backup files

## Upgrade Notes

No special upgrade steps required. The store is optional:

```bash
# Initialize store when ready
mcli self store init

# Add remote if desired
mcli self store config --remote git@github.com:user/mcli-commands.git

# Push existing commands
mcli self store push -m "Initial sync"
```

## Future Enhancements

Potential improvements for future releases:
- Automatic sync on command add/update
- Store templates for common command patterns
- Command diff before pull
- Selective command sync (pick specific commands)
- Integration with command lock (version tracking)
- Auto-backup old commands before updates
- Store validation and health checks

## Comparison to Alternatives

| Feature | mcli store | stow | rcm | git submodules |
|---------|------------|------|-----|----------------|
| Simplicity | ✓ | ✗ | ✗ | ✓ |
| Git integration | ✓ | ✗ | ✗ | ✓ |
| Backup | ✓ | ✗ | ✓ | ✗ |
| Sync | ✓ | ✗ | ✓ | ✓ |
| Configuration | Minimal | Complex | Medium | Minimal |
| Learning curve | Low | Medium | Medium | Low |

## Credits

Feature inspired by user request for "lsh secrets-style management but simpler" to replace stow/rcm for command version control.

**Original User Feedback:**
> "can't you use the same logic of the lsh secrets functionality to create a dotfile store instead of a secrets store. i find the stow and rcm are unnecessarily complicated."

---

**Version:** 7.8.3
**Previous Version:** 7.8.2
**Git Tag:** v7.8.3
