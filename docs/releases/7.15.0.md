# Release 7.15.0

**Release Date**: 2025-11-15

## Overview

Feature release adding automatic detection and integration of package.json scripts as mcli workflows. This enhancement allows developers to seamlessly run npm scripts through mcli's workflow system without manual configuration.

## New Features

### Auto-Detection of package.json Scripts as Workflows

**Feature**: When working in a directory with a `package.json` file, mcli now automatically detects npm scripts and exposes them as workflow commands.

**How It Works**:
- Searches for `package.json` in `.mcli/package.json` first, then falls back to current directory
- Parses the `scripts` section and creates corresponding mcli commands
- Scripts are accessible via `mcli run npm <script-name>`
- Supports passing additional arguments to npm scripts
- Only active in local (non-global) workflow mode

**Example**:

Given a `package.json` with:
```json
{
  "scripts": {
    "test": "jest",
    "build": "webpack",
    "dev": "webpack-dev-server"
  }
}
```

You can now run:
```bash
mcli run npm test           # Runs: npm run test
mcli run npm build          # Runs: npm run build
mcli run npm dev            # Runs: npm run dev
mcli run npm test -- --verbose  # Pass additional arguments
```

**Files Added**:
- `src/mcli/lib/packagejson_workflows.py` - Package.json parsing and command generation

**Files Changed**:
- `src/mcli/workflow/workflow.py` - Added auto-detection in `ScopedWorkflowsGroup`

**Benefits**:
- Unified interface for running both mcli workflows and npm scripts
- No need to maintain separate command patterns
- Seamless integration with existing workflow system
- Complements existing Makefile workflow support

## Technical Details

### Implementation

The package.json workflow system:
1. **Discovery**: On `mcli run` invocation, checks for package.json files
2. **Parsing**: Extracts script names and commands from the `scripts` section
3. **Command Creation**: Dynamically creates Click commands for each script
4. **Execution**: Runs `npm run <script>` in the package.json directory
5. **Argument Forwarding**: Supports passing additional arguments via `--`

### Search Order

When looking for package.json:
1. `.mcli/package.json` (project-specific workflows)
2. `package.json` (standard location)

### Error Handling

- Gracefully handles missing npm installation
- Proper error messages for invalid JSON
- Returns npm's exit code for proper CI/CD integration

## Testing

Manual testing confirmed:
- ✅ Auto-detection works in directories with package.json
- ✅ Scripts execute correctly with npm run
- ✅ Additional arguments are forwarded properly
- ✅ Works alongside existing workflows (Makefile, custom workflows)
- ✅ Only activates in local mode (not global with `-g`)
- ✅ Proper error handling when npm is not installed
- ✅ Executes in package.json's directory context

## Example Usage

```bash
# List available workflows (including npm scripts if package.json exists)
mcli run

# Run npm script
mcli run npm test

# Run with arguments
mcli run npm build -- --production

# Still works with other workflows
mcli run make clean
mcli run scheduler start
```

## Installation

```bash
# Using uv (recommended)
uv tool install mcli-framework --force

# Using pip
pip install --upgrade mcli-framework

# Using pipx
pipx install mcli-framework --force
```

## Upgrade Notes

This is a feature release. No configuration changes required.

To upgrade:
```bash
mcli self update
```

Or reinstall:
```bash
uv tool install mcli-framework --force --reinstall
```

## Compatibility

- **Python**: 3.9, 3.10, 3.11, 3.12
- **Node.js**: Any version with npm (optional, only needed if using package.json workflows)
- **Operating Systems**: macOS, Linux, Windows

## Known Issues

None - all tests passing.

## Future Enhancements

Potential future additions:
- Support for pnpm and yarn scripts
- Package.json script descriptions in help text
- Interactive script selection
- Script dependency visualization

## Links

- **PyPI**: https://pypi.org/project/mcli-framework/7.15.0/
- **GitHub**: https://github.com/gwicho38/mcli/releases/tag/v7.15.0
- **Documentation**: https://github.com/gwicho38/mcli/tree/main/docs

---

**Previous Release**: [7.14.5](7.14.5.md)
**Next Release**: 7.15.1 (planned)
