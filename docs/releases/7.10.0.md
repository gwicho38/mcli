# Release 7.10.0

**Release Date:** 2025-10-19

## Summary
Major feature release adding first-class shell command support to the MCLI workflow system, enabling users to create workflow commands in both Python and Shell languages.

## 🎉 New Features

### Shell Command Support
MCLI now supports creating and managing workflow commands in multiple shell languages alongside Python commands.

#### Supported Shells
- **bash** - Bourne Again Shell (default)
- **zsh** - Z Shell
- **fish** - Friendly Interactive Shell
- **sh** - POSIX Shell

#### Key Capabilities
- ✅ **Create shell commands** using `mcli commands add --language shell`
- ✅ **Auto-detect shell type** from shebang or file extension
- ✅ **Import existing shell scripts** with `mcli commands import script.sh -s`
- ✅ **Template mode** for quick command creation
- ✅ **Editor mode** for interactive development
- ✅ **Argument passing** - pass CLI arguments to shell scripts
- ✅ **Environment variables** - access command metadata via `$MCLI_COMMAND`
- ✅ **Unified management** - same interface for Python and shell commands

### New Command Options

#### `mcli commands add`
```bash
# New options
--language, -l [python|shell]  # Choose command language (default: python)
--shell, -s [bash|zsh|fish|sh] # Specify shell type for shell commands

# Examples
mcli commands add backup --language shell --template
mcli commands add deploy -l shell --shell bash
```

#### `mcli commands import`
```bash
# Auto-detects shell scripts
mcli commands import script.sh -s
mcli commands import deploy.sh -s --name deploy_prod
```

## 📝 Implementation Details

### JSON Command Format Extension
Shell commands are stored with additional fields:

```json
{
  "name": "my_command",
  "language": "shell",    // NEW: "python" or "shell"
  "shell": "bash",        // NEW: shell type for shell commands
  "code": "#!/usr/bin/env bash\n...",
  "description": "My shell command",
  "group": "workflow",
  "version": "1.0",
  "metadata": {}
}
```

### Architecture Changes

#### CustomCommandManager (`src/mcli/lib/custom_commands.py`)
- Added `register_shell_command_with_click()` method for shell command registration
- Extended `save_command()` to support `language` and `shell` parameters
- Updated `load_custom_commands()` to route shell commands appropriately
- Shell commands execute via temporary script files with proper cleanup

#### Commands Interface (`src/mcli/app/commands_cmd.py`)
- Added `get_shell_command_template()` for shell script templates
- Extended `add_command()` with `--language` and `--shell` options
- Enhanced `import_commands()` with auto-detection of shell scripts
- Improved output to display language and shell type

### Shell Command Execution Flow
1. Load JSON command file
2. Extract shell code and metadata
3. Create temporary script file with shebang
4. Make script executable (`chmod +x`)
5. Execute via subprocess with argument passing
6. Capture stdout/stderr
7. Return exit code
8. Clean up temporary file

## 📚 Documentation

- New comprehensive guide: `docs/features/SHELL_COMMANDS.md`
  - Quick start examples
  - Real-world use cases
  - Best practices
  - Troubleshooting guide
  - Migration guide

## 🔧 Technical Details

### Files Modified
- `src/mcli/lib/custom_commands.py` - Added shell command registration
- `src/mcli/app/commands_cmd.py` - Extended command creation/import interface

### New Dependencies
No new external dependencies required. Uses only Python standard library:
- `os.stat` - For file permissions
- `subprocess` - For shell script execution
- `tempfile` - For temporary script files

### Security Considerations
- ✅ Temporary files created with secure tempfile module
- ✅ Scripts executed with explicit shell specification
- ✅ Environment variable sanitization
- ✅ Exit code handling
- ✅ Proper subprocess cleanup

## 💡 Usage Examples

### Creating a Shell Command
```bash
# Template mode (fastest)
mcli commands add backup_db --language shell --template

# Interactive editor mode
mcli commands add deploy --language shell --description "Deploy application"

# Specific shell type
mcli commands add zsh_task -l shell --shell zsh
```

### Importing Existing Scripts
```bash
# Auto-detects language and shell
mcli commands import ~/scripts/backup.sh -s

# With custom name
mcli commands import deploy.sh -s --name deploy_prod
```

### Executing Shell Commands
```bash
# Same interface as Python commands
mcli workflow backup_db production
mcli workflow deploy staging --force
```

### Managing Shell Commands
```bash
# List all custom commands
mcli commands list --custom-only

# View command details
mcli commands info backup_db

# Edit command
mcli commands edit backup_db

# Export to shell script
mcli commands export backup_db -s -o backup.sh

# Remove command
mcli commands remove old_backup --yes
```

## 🎯 Real-World Use Cases

### 1. Git Operations
```bash
#!/usr/bin/env bash
# Enhanced git status with colors
git status --short
git log -1 --oneline
```

### 2. Database Backups
```bash
#!/usr/bin/env bash
DB_NAME="${1:-mydb}"
mysqldump "$DB_NAME" > "backup_$(date +%Y%m%d).sql"
gzip "backup_$(date +%Y%m%d).sql"
```

### 3. Docker Management
```bash
#!/usr/bin/env bash
docker ps --format "table {{.Names}}\t{{.Status}}"
docker system prune -f
```

### 4. Deployment Scripts
```bash
#!/usr/bin/env bash
ENV="${1:-staging}"
git pull origin main
npm install
npm run build
pm2 reload "$ENV"
```

## 🔄 Backward Compatibility

- ✅ **100% backward compatible** - Existing Python commands work unchanged
- ✅ **Default behavior preserved** - `mcli commands add` defaults to Python
- ✅ **Automatic migration** - Old commands without `language` field default to "python"
- ✅ **No breaking changes** - All existing APIs remain functional

## 🚀 Performance

- **Minimal overhead** - Shell commands execute directly via subprocess
- **Efficient cleanup** - Temporary files automatically removed
- **Fast startup** - Lazy loading prevents performance impact
- **Memory efficient** - No shell interpreters kept in memory

## 🐛 Bug Fixes

### Fixed Import Error in Model Command (from 7.9.7)
- Removed unused `load_command_from_file` import in `model_cmd.py`
- Fixed `ImportError` when running `mcli commands search`

## 📊 Testing

### Tested Scenarios
- ✅ Shell command creation (template and editor modes)
- ✅ Shell command execution with arguments
- ✅ Multiple shell types (bash, zsh, sh)
- ✅ Shell script import with auto-detection
- ✅ Mixed Python and shell command workflows
- ✅ Command listing and management
- ✅ Export to shell script files
- ✅ Error handling and exit codes

### Example Test Commands Created
- `git_status` - Enhanced git status display
- `test_shell` - Template-based test command
- `backup_demo` - Backup simulation script

## 🔮 Future Enhancements

Potential future additions:
- Support for other languages (Ruby, Node.js, Perl)
- Shell script linting integration
- Shell command testing framework
- Built-in shell function library
- Advanced argument parsing for shell commands

## 📦 Installation

Update to 7.10.0:
```bash
pip install --upgrade mcli-framework==7.10.0
```

Or via uv:
```bash
uv pip install --upgrade mcli-framework==7.10.0
```

## 🙏 Acknowledgments

This feature enables seamless integration of shell scripts into the MCLI workflow system, providing flexibility to choose Python for complex logic and shell for system operations.

## 📈 Version Comparison

| Feature | 7.9.x | 7.10.0 |
|---------|-------|--------|
| Python Commands | ✅ | ✅ |
| Shell Commands | ❌ | ✅ |
| Multi-Shell Support | ❌ | ✅ bash, zsh, fish, sh |
| Auto-Detection | ❌ | ✅ |
| Template Mode | ✅ (Python only) | ✅ (Python + Shell) |
| Import Scripts | ✅ (Python only) | ✅ (Python + Shell) |
| Argument Passing | ✅ | ✅ |
| Environment Variables | Partial | ✅ `$MCLI_COMMAND` |

## 🔗 Related Documentation

- [Shell Commands Guide](../features/SHELL_COMMANDS.md)
- [Command Management](../features/COMMAND_MANAGEMENT.md)
- [Workflow System](../README.md)
