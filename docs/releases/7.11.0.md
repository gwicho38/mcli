# Release 7.11.0 - Command Structure Overhaul

**Release Date**: 2025-10-30

## Overview

Version 7.11.0 represents a major reorganization of MCLI's command structure to improve clarity, consistency, and usability. This release introduces a new command hierarchy, automated migration tools, and moves secrets management to a more logical location.

## 🎯 Major Changes

### Command Structure Reorganization

The command structure has been completely reorganized for better clarity:

| Old Command | New Command | Purpose |
|-------------|-------------|---------|
| `mcli commands` | `mcli workflow` | **Manage** workflows (create, edit, import, export) |
| `mcli workflow` | `mcli workflows` | **Run** workflows (execute workflow commands) |
| `mcli lib secrets` | `mcli workflows secrets` | Secrets management (now a workflow) |
| `mcli lib` | **REMOVED** | Deprecated and removed |

### Directory Structure Change

| Old Path | New Path |
|----------|----------|
| `~/.mcli/commands/` | `~/.mcli/workflows/` |

The directory has been renamed to better reflect its purpose. The system supports both locations during migration.

## ✨ New Features

### 1. **Automated Migration Command**

Introducing `mcli self migrate` - a comprehensive migration tool:

```bash
# Check what needs migration
mcli self migrate --status

# Preview migration (safe)
mcli self migrate --dry-run

# Perform migration
mcli self migrate

# Force migration with backups
mcli self migrate --force
```

**Features:**
- Beautiful Rich UI with progress tables
- Dry-run mode for safety
- Automatic file backup when forcing
- Detailed migration reports
- Status checking before migration

### 2. **Unified Secrets Workflow**

Secrets management has been moved from `lib` to `workflows` and unified into a single command:

```bash
# All operations now use one command with flags
mcli workflows secrets --repl                    # Interactive shell
mcli workflows secrets --set KEY value           # Set secret
mcli workflows secrets --get KEY                 # Get secret
mcli workflows secrets --list                    # List all secrets
mcli workflows secrets --delete KEY              # Delete secret
mcli workflows secrets --export                  # Export as env vars
mcli workflows secrets --import-file .env        # Import from file
mcli workflows secrets --store-init              # Initialize git store
mcli workflows secrets --store-sync              # Sync with git
```

**Previous subcommands consolidated:**
- `mcli lib secrets set` → `mcli workflows secrets --set`
- `mcli lib secrets get` → `mcli workflows secrets --get`
- `mcli lib secrets store push` → `mcli workflows secrets --store-push`

### 3. **Smart Path Resolution**

The path resolution system now intelligently handles both old and new directory locations:

- Checks `~/.mcli/workflows/` first (new)
- Falls back to `~/.mcli/commands/` (old, for migration)
- Auto-creates `~/.mcli/workflows/` for new installations
- Supports both global (`~/.mcli/`) and local (`.mcli/`) workflows

## 🔄 Backward Compatibility

### Aliases Included

For a smooth transition, the old commands are temporarily aliased:

- `mcli commands` → works as `mcli workflow`
- Old workflow execution still works
- Path resolution checks both directories

### Deprecation Timeline

- **7.11.0** (Now): Both old and new commands work
- **7.x.x** (Future): Deprecation warnings added
- **8.0.0**: Old command aliases removed

## 📝 Files Created (5)

1. **`src/mcli/self/migrate_cmd.py`** - Migration command implementation
2. **`src/mcli/workflow/secrets/__init__.py`** - Secrets workflow package
3. **`src/mcli/workflow/secrets/secrets_cmd.py`** - Unified secrets command
4. **`docs/COMMAND_MIGRATION_GUIDE.md`** - Complete migration guide
5. **`docs/releases/COMMAND_RESTRUCTURE_SUMMARY.md`** - Technical summary

## 📝 Files Modified (7)

1. **`src/mcli/app/main.py`** - Updated command registrations, removed lib group
2. **`src/mcli/app/commands_cmd.py`** - Renamed group to `workflow`, updated all decorators
3. **`src/mcli/workflow/workflow.py`** - Renamed group to `workflows`, added secrets
4. **`src/mcli/lib/paths.py`** - Smart path resolution with migration support
5. **`src/mcli/self/self_cmd.py`** - Added migrate command registration
6. **`README.md`** - Updated all command examples
7. **`CLAUDE.md`** - Updated command structure documentation

## 🎨 New Command Structure

```
mcli/
├── version                # Show version info
├── self                   # Self-management commands
│   ├── update
│   ├── completion
│   ├── migrate            # ✨ NEW: Migration tool
│   └── ...
├── workflow               # Manage workflows (formerly 'commands')
│   ├── add                # Create new workflow
│   ├── edit               # Edit workflow
│   ├── import             # Import workflows
│   ├── export             # Export workflows
│   ├── list               # List all workflows
│   ├── search             # Search workflows
│   ├── remove             # Remove workflow
│   ├── info               # Workflow details
│   ├── verify             # Verify lockfile
│   ├── update-lockfile    # Update lockfile
│   └── store              # Store operations
└── workflows              # Run workflows (formerly 'workflow')
    ├── secrets            # ✨ NEW: Secrets management (moved from lib)
    ├── notebook           # Notebook management
    ├── pdf                # PDF processing
    ├── clean              # System cleanup
    ├── scheduler          # Job scheduling
    ├── daemon             # Daemon management
    └── [custom-workflows] # Your custom workflows
```

## 🚀 Migration Guide

### Quick Migration

```bash
# 1. Check status
mcli self migrate --status

# 2. Preview what will happen
mcli self migrate --dry-run

# 3. Perform migration
mcli self migrate

# 4. Verify
mcli workflow list
mcli workflows secrets --list
```

### Update Your Scripts

```bash
# Old → New
mcli commands list              → mcli workflow list
mcli commands add my-task       → mcli workflow add my-task
mcli commands import file.json  → mcli workflow import file.json
mcli workflow my-task           → mcli workflows my-task
mcli lib secrets get API_KEY    → mcli workflows secrets --get API_KEY
```

### For CI/CD Pipelines

```yaml
# Add migration step (optional but recommended)
- name: Migrate MCLI
  run: mcli self migrate

# Update command syntax
- name: Import workflows
  run: mcli workflow import workflows.json  # was: mcli commands import

- name: Run workflow
  run: mcli workflows build-project        # was: mcli workflow build-project

- name: Get secret
  run: mcli workflows secrets --get API_KEY --show  # was: mcli lib secrets get API_KEY --show
```

## 💡 Benefits

### 1. **Clarity**
- `workflow` clearly means "manage workflows"
- `workflows` clearly means "run workflows"
- No more confusion between similar command names

### 2. **Consistency**
- All executable workflows under `workflows` group
- All management commands under `workflow` group
- Secrets logically grouped with other workflows

### 3. **Simplification**
- Removed confusing `lib` group
- Single location for workflow files
- Clearer command hierarchy

### 4. **Better UX**
- Automated migration removes manual work
- Smart path resolution handles both locations
- Clear migration status and reporting

## 📚 Documentation

- **[Command Migration Guide](../COMMAND_MIGRATION_GUIDE.md)** - Complete migration instructions
- **[Command Restructure Summary](COMMAND_RESTRUCTURE_SUMMARY.md)** - Technical details
- **[README](../../README.md)** - Updated with new commands
- **[CLAUDE.md](../../CLAUDE.md)** - Updated for AI assistants

## 🧪 Testing

All commands have been tested and verified:

- ✅ Command structure works correctly
- ✅ Migration command functions properly
- ✅ Path resolution handles both directories
- ✅ Secrets workflow accessible and functional
- ✅ Backward compatibility maintained
- ✅ Documentation updated and accurate

## ⚠️ Breaking Changes

None in this release. All old commands still work via aliases.

**Future breaking changes** (version 8.0.0):
- Old command aliases will be removed
- Only new command structure will work

## 🐛 Bug Fixes

None specific to this release - focus was on restructuring.

## 📊 Statistics

- **Commands Renamed**: 3
- **Commands Removed**: 1 group (`mcli lib`)
- **Commands Added**: 1 (`mcli self migrate`)
- **Files Created**: 5
- **Files Modified**: 7
- **Lines Changed**: ~800
- **Documentation Added**: 2 major guides

## 🙏 Acknowledgments

This restructuring was driven by user feedback requesting:
- Clearer command organization
- Better secrets management location
- Elimination of confusing `lib` group

Thank you to all users who provided feedback!

## 🔗 Related Issues

- User request: Clarify command structure
- User request: Move secrets to workflows
- User request: Remove confusing lib group
- User request: Automated migration tools

## 📞 Support

- **Documentation**: [docs/INDEX.md](../INDEX.md)
- **Migration Guide**: [COMMAND_MIGRATION_GUIDE.md](../COMMAND_MIGRATION_GUIDE.md)
- **GitHub Issues**: [mcli/issues](https://github.com/gwicho38/mcli/issues)
- **GitHub Discussions**: [mcli/discussions](https://github.com/gwicho38/mcli/discussions)

---

## Upgrade Instructions

```bash
# Via pip
pip install --upgrade mcli-framework

# Via UV (recommended)
uv pip install --upgrade mcli-framework

# Verify installation
mcli version  # Should show 7.11.0

# Run migration
mcli self migrate --status
mcli self migrate
```

---

**For detailed technical information**, see [COMMAND_RESTRUCTURE_SUMMARY.md](COMMAND_RESTRUCTURE_SUMMARY.md)

**For step-by-step migration**, see [COMMAND_MIGRATION_GUIDE.md](../COMMAND_MIGRATION_GUIDE.md)

---

**Version**: 7.11.0
**Release Date**: 2025-10-30
**Type**: Major Feature Release
**Breaking Changes**: None (with backward compatibility)
