# Release 7.19.13

**Release Date:** 2025-11-29

## Summary

This release fixes a critical bug in `mcli new` where the template code was being truncated due to nested docstrings, and user code was still being lost.

## Bug Fixes

### Command Creation (`mcli new`)
- **Fixed:** Template code was being truncated at the first function docstring due to incorrect `"""` splitting
- **Fixed:** The instruction docstring extraction was finding nested `"""` instead of the actual closing `"""`
- **Simplified:** Removed the `# Your command implementation goes here:` marker - users now edit the template directly
- **Improved:** Changed example in instruction docstring to use comments instead of docstrings to avoid confusion

## Technical Details

The previous fix (7.19.12) addressed part of the issue, but there were two remaining problems:

1. **Template extraction bug (line 169):** The code `template.split('"""')[2].split('"""')[0]` was splitting on ALL `"""` in the template, including function docstrings like `"""Description for command group."""`. This caused the template to be truncated before `def app():` body.

2. **Instruction docstring detection bug:** When removing the instruction docstring, the code was finding the first `"""` after the opening, but the instruction docstring contained an example with a nested docstring (`"""My custom command."""`), so it was cutting at the wrong place.

The fix:
1. Uses line-by-line scanning to find module docstrings (looking for `"""` on its own line)
2. Properly extracts template code by finding the closing `"""` of the module docstring
3. Simplified the template to not include confusing markers

## Files Changed

- `src/mcli/app/new_cmd.py` - Fixed template extraction and instruction docstring removal
- `tests/unit/test_new_cmd.py` - Updated tests for new simpler extraction logic

## Testing

- All 6 new_cmd tests pass
- Tests specifically cover nested docstring handling

## Migration Notes

No action required. If you created commands with 7.19.12, you may need to recreate them with 7.19.13.

---

**Full Changelog:** https://github.com/gwicho38/mcli/compare/v7.19.12...v7.19.13
