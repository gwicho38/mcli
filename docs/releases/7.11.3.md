# Release Notes: mcli v7.11.3

**Release Date:** October 30, 2025
**Previous Version:** v7.11.2
**Type:** Feature Release

## Overview

This release adds the `-g/--global` flag to the `mcli workflows` command, enabling users to execute workflows from either local (`.mcli/workflows/`) or global (`~/.mcli/workflows/`) scope ad hoc. This provides flexible workflow execution across different scopes without changing directory context.

## ‚ú® New Features

### Global Workflow Execution Flag

**Feature:** Add `-g/--global` flag to workflows command for scope selection

Users can now execute workflows from either local or global scope using the `-g` flag:

```bash
# Execute local workflow (from .mcli/workflows/ if in git repo)
mcli workflows my-workflow

# Execute global workflow (from ~/.mcli/workflows/)
mcli workflows -g my-workflow
mcli workflows --global my-workflow
```

**Use Cases:**

1. **Project-specific workflows**: Keep workflows in `.mcli/workflows/` for project-specific automation
2. **Shared workflows**: Store common workflows in `~/.mcli/workflows/` for use across all projects
3. **Quick execution**: Run global workflows from any directory without changing context

**Example Workflow:**

```bash
# In any git repository
cd ~/repos/my-project

# Run local workflow for project-specific tasks
mcli workflows build-and-test

# Run global workflow for cross-project tasks
mcli workflows -g deploy-to-staging

# Run another global workflow
mcli workflows --global backup-databases
```

**Implementation Details:**

The feature is implemented using a custom Click group class (`ScopedWorkflowsGroup`) that:
- Captures the `-g/--global` flag from the command line
- Dynamically loads commands from the appropriate directory based on scope
- Preserves backward compatibility with existing workflows
- Integrates seamlessly with the existing command manager infrastructure

## üîß Technical Changes

### Modified Files

**`src/mcli/workflow/workflow.py`** (67 lines added)
- Added `ScopedWorkflowsGroup` custom Click group class
- Implemented `list_commands()` method to list commands from correct scope
- Implemented `get_command()` method to load commands from correct scope
- Added `-g/--global` option to workflows group decorator
- Stored scope flag in Click context for subcommands to access

**`src/mcli/app/main.py`** (18 lines changed)
- Changed workflows group loading from lazy-loaded to direct import
- Ensures `-g/--global` option parameters are visible to CLI
- Added fallback to lazy loading if direct import fails
- Enhanced debug logging for workflows group loading

### Architecture

```
mcli workflows [OPTIONS] COMMAND [ARGS]...
      ‚îÇ
      ‚îú‚îÄ -g/--global flag captured by ScopedWorkflowsGroup
      ‚îÇ
      ‚îú‚îÄ list_commands():
      ‚îÇ   ‚îî‚îÄ Uses get_command_manager(global_mode=is_global)
      ‚îÇ       ‚îú‚îÄ If is_global=False: load from .mcli/workflows/
      ‚îÇ       ‚îî‚îÄ If is_global=True:  load from ~/.mcli/workflows/
      ‚îÇ
      ‚îî‚îÄ get_command():
          ‚îî‚îÄ Dynamically load and register command from appropriate scope
```

## üìä Statistics

- **Lines Added:** 85
- **Lines Removed:** 18
- **Files Modified:** 2
- **Net Lines Changed:** +67
- **Feature Complexity:** Medium (custom Click group implementation)

## üîÑ Upgrade Instructions

### For All Users

```bash
# Upgrade via pip
pip install --upgrade mcli-framework

# Or with UV
uv pip install --upgrade mcli-framework

# Verify version
mcli version  # Should show 7.11.3
```

### For uv tool Users

```bash
# Upgrade tool installation
uv tool upgrade mcli-framework

# Or force reinstall
uv tool install --force mcli-framework

# Verify version
mcli version  # Should show 7.11.3
```

## üìñ Usage Examples

### Example 1: Project-specific Build Workflow

```bash
cd ~/repos/my-flutter-app

# Run local build workflow
mcli workflows build
```

### Example 2: Global Deployment Workflow

```bash
cd ~/repos/any-project

# Run global deployment workflow from anywhere
mcli workflows -g deploy-prod
```

### Example 3: Mixing Local and Global

```bash
cd ~/repos/my-api

# Run local tests
mcli workflows test

# Run global backup before deployment
mcli workflows -g backup-databases

# Run local deployment
mcli workflows deploy
```

### Example 4: List Available Workflows

```bash
# List local workflows (if in git repo)
mcli workflows --help

# List global workflows
mcli workflows -g --help
```

## üîÑ Backward Compatibility

- ‚úÖ **Fully backward compatible**
- Existing workflows continue to work without modification
- Default behavior (no `-g` flag) unchanged:
  - In git repo: uses `.mcli/workflows/`
  - Outside git repo: uses `~/.mcli/workflows/`
- Migration logic for old `commands/` directory still active

## üêõ Known Issues

None at this time. The feature has been tested and verified working correctly.

## üí° Tips

1. **Organize your workflows**: Keep project-specific workflows in `.mcli/workflows/`, shared workflows in `~/.mcli/workflows/`
2. **Global workflow names**: Use descriptive names for global workflows to avoid confusion (e.g., `deploy-to-staging`, not just `deploy`)
3. **Check available workflows**: Use `mcli workflows --help` and `mcli workflows -g --help` to see what's available in each scope
4. **Tab completion**: Shell completion works with both local and global workflows (if completion is installed)

## üîó Links

- **PyPI Package:** https://pypi.org/project/mcli-framework/
- **GitHub Repository:** https://github.com/gwicho38/mcli
- **Documentation:** https://github.com/gwicho38/mcli/tree/main/docs
- **Previous Release:** [v7.11.2](./7.11.2.md)

## üéØ What's Next

Future enhancements being considered:
- Workflow templates for common patterns
- Workflow dependencies and chaining
- Workflow parameters and configuration
- Interactive workflow builder

---

**Full Changelog:** https://github.com/gwicho38/mcli-framework/compare/v7.11.2...v7.11.3
