# Release Notes: mcli v7.11.2

**Release Date:** October 30, 2025
**Previous Version:** v7.11.1
**Type:** Hotfix Release

## Overview

This hotfix release fixes a critical issue where `mcli workflow init` would create `.mcli/commands/` instead of `.mcli/workflows/` when an old commands directory already existed in the repository from previous versions.

## üêõ Bug Fixes

### workflow init Always Creates workflows/ Directory

**Problem:**
When running `mcli workflow init` in a repository that had an existing `.mcli/commands/` directory from a previous mcli version, the init command would use the old `commands` directory instead of creating the new `workflows` directory structure.

**Example of the Bug:**
```bash
$ cd ~/repos/my-project
$ mcli workflow init
‚úì Created workflows directory: /Users/me/repos/my-project/.mcli/commands  # ‚ùå Wrong!
```

**Root Cause:**
The init command was using `get_custom_commands_dir()` which includes migration logic to check for existing `commands/` directories. This was correct for normal operations (to maintain backward compatibility), but wrong for the init command which should always create the modern directory structure.

**Solution:**
Changed the init command to explicitly construct the workflows directory path, bypassing the migration logic:

```python
# Before: Used path resolution with migration logic
workflows_dir = get_custom_commands_dir(global_mode=is_global)

# After: Explicitly create workflows directory
if not is_global and in_git_repo:
    local_mcli = get_local_mcli_dir()
    workflows_dir = local_mcli / "workflows"  # Always use workflows/
else:
    workflows_dir = get_mcli_home() / "workflows"
```

**Impact:**
- ‚úÖ `mcli workflow init` now always creates `.mcli/workflows/` directory
- ‚úÖ Works correctly even if `.mcli/commands/` exists from previous versions
- ‚úÖ Migration logic preserved for other commands (list, add, etc.)

## üîß Technical Changes

### Modified Files

**`src/mcli/app/commands_cmd.py`** (6 lines changed)
- Changed imports to use explicit path functions
- Construct workflows directory path directly
- Add explanatory comment about bypassing migration logic

## üìä Statistics

- **Lines Changed:** 6
- **Files Modified:** 1
- **Bug Severity:** High (core functionality broken)
- **Workaround:** Users could manually delete `.mcli/commands` and re-run init

## üîÑ Upgrade Instructions

### For All Users

```bash
# Upgrade via pip
pip install --upgrade mcli-framework

# Or with UV
uv pip install --upgrade mcli-framework

# Verify version
mcli version  # Should show 7.11.2
```

### For Affected Repositories

If you already ran `mcli workflow init` with version 7.11.1 and it created `.mcli/commands/`:

```bash
cd ~/your-repo

# Option 1: Remove old commands and reinit
rm -rf .mcli/commands
mcli workflow init

# Option 2: Manually rename
mv .mcli/commands .mcli/workflows

# Verify
ls .mcli/  # Should show 'workflows' directory
```

## üìñ Verification

After upgrading, test the fix:

```bash
# In a fresh git repository
cd ~/test-repo
git init

# Run init
mcli workflow init

# Verify it created workflows/ (not commands/)
ls -la .mcli/
# Should show: workflows/
```

## üîÑ Backward Compatibility

- ‚úÖ **Fully backward compatible**
- Existing `.mcli/commands/` directories continue to work for normal operations
- Migration logic still active for `list`, `add`, `edit`, etc.
- Only `init` command explicitly creates `workflows/`

## üîó Links

- **PyPI Package:** https://pypi.org/project/mcli-framework/
- **GitHub Repository:** https://github.com/gwicho38/mcli
- **Documentation:** https://github.com/gwicho38/mcli/tree/main/docs
- **Previous Release:** [v7.11.1](./7.11.1.md)

## üôè Acknowledgments

Thank you to users who reported this issue immediately after the 7.11.1 release, allowing for a rapid hotfix.

---

**Full Changelog:** https://github.com/gwicho38/mcli-framework/compare/v7.11.1...v7.11.2
