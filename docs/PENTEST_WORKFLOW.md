# MCLI Pentest Workflow

## Overview

The MCLI Pentest Workflow is a comprehensive automation tool for HackerOne bug bounty hunting. It streamlines the entire pen testing workflow from program discovery to professional report generation.

## Features

### üîç Program Discovery
- Fetch HackerOne bug bounty programs
- Filter by program name
- Export program data to JSON

### üìä Scope Analysis
- Analyze program scope and guidelines
- Extract in-scope and out-of-scope assets
- Identify recommended vulnerability types

### üõ†Ô∏è Test Script Generation
- **CSRF Testing** - Cross-Site Request Forgery vulnerability detection
- **XSS Testing** - Cross-Site Scripting payload testing
- **Referrer Leak Testing** - Session token leakage via HTTP headers
- **SQL Injection Testing** - Database vulnerability probing
- **Auth Bypass Testing** - Authentication mechanism testing

### üìÑ Report Generation
- Professional HackerOne-ready markdown reports
- Pre-built templates for common vulnerabilities
- Interactive and automated modes
- Severity levels and impact assessments

### üöÄ Complete Workflow
- End-to-end automation: discover ‚Üí analyze ‚Üí test ‚Üí report
- One-command execution option
- Test script execution with confirmation

## Installation

The pentest command is automatically available after creating it:

```bash
# The command is already created at ~/.mcli/commands/pentest.json
# Reload MCLI or restart your shell to use it
```

### Dependencies

Install required Python packages:

```bash
pip install requests beautifulsoup4
```

## Usage

### Basic Commands

#### List Available Templates

```bash
mcli workflow pentest list-templates
```

Displays all available test script and report templates.

#### Discover Programs

```bash
# Discover HackerOne programs
mcli workflow pentest discover

# Limit results
mcli workflow pentest discover --limit 10

# Filter by name
mcli workflow pentest discover --filter stripe

# Save to file
mcli workflow pentest discover --output programs.json
```

**Note**: Full program discovery requires HackerOne API authentication. Set `HACKERONE_API_TOKEN` environment variable.

#### Analyze Program

```bash
# Analyze a specific program
mcli workflow pentest analyze https://hackerone.com/stripchat?type=team

# Save analysis
mcli workflow pentest analyze https://hackerone.com/stripchat?type=team --output analysis.json
```

#### Generate Test Scripts

```bash
# Generate CSRF test
mcli workflow pentest generate-test -t csrf -u https://example.com/form

# Generate XSS test
mcli workflow pentest generate-test -t xss -u https://example.com/search

# Generate referrer leak test
mcli workflow pentest generate-test -t referrer-leak -u https://example.com

# Generate SQL injection test
mcli workflow pentest generate-test -t sql-injection -u https://example.com/api

# Generate auth bypass test
mcli workflow pentest generate-test -t auth-bypass -u https://example.com/admin

# Specify output file
mcli workflow pentest generate-test -t csrf -u https://example.com --output my_test.sh
```

Generated scripts are executable bash scripts with proper permissions.

#### Generate Reports

```bash
# Generate report with template
mcli workflow pentest report \
  --template csrf \
  --title "CSRF Vulnerability in Login Form" \
  --severity high \
  --program "Example Program"

# Interactive mode
mcli workflow pentest report \
  --title "Custom Vulnerability" \
  --interactive

# Specify output file
mcli workflow pentest report \
  --template referrer-leak \
  --title "Session Token Leakage" \
  --severity medium \
  --output my_report.md
```

#### Complete Workflow

```bash
# Run full workflow (analyze + test + report)
mcli workflow pentest workflow \
  https://hackerone.com/stripchat?type=team \
  --vuln-type csrf

# Execute tests automatically
mcli workflow pentest workflow \
  https://hackerone.com/stripchat?type=team \
  --vuln-type referrer-leak \
  --execute
```

**‚ö†Ô∏è Warning**: Only use `--execute` on authorized targets with explicit permission!

## Example Workflows

### Scenario 1: CSRF Testing on Google Forms

Based on your referrer leakage research:

```bash
# 1. Analyze the program
mcli workflow pentest analyze https://hackerone.com/example-program

# 2. Generate CSRF test for Google Form
mcli workflow pentest generate-test \
  -t csrf \
  -u "https://docs.google.com/forms/d/e/FORM_ID/viewform" \
  -o csrf_google_forms_test.sh

# 3. Review the generated script
cat csrf_google_forms_test.sh

# 4. Execute (ensure authorization!)
bash csrf_google_forms_test.sh

# 5. Generate professional report
mcli workflow pentest report \
  --template csrf \
  --title "CSRF Vulnerability in Google Forms Integration" \
  --severity medium \
  --program "Example Program" \
  --output hackerone_report.md
```

### Scenario 2: Referrer Header Leakage Testing

```bash
# 1. Generate referrer leak test
mcli workflow pentest generate-test \
  -t referrer-leak \
  -u "https://example.com/redirect" \
  -o referrer_leak_test.sh

# 2. Execute the test
bash referrer_leak_test.sh

# 3. Generate report with findings
mcli workflow pentest report \
  --template referrer-leak \
  --title "Session Token Exposure via Referrer Headers" \
  --severity high \
  --program "Example Program" \
  --output referrer_leak_report.md
```

### Scenario 3: Complete Automated Workflow

```bash
# One-command complete workflow
mcli workflow pentest workflow \
  https://hackerone.com/program-name \
  --vuln-type referrer-leak

# Files generated in /tmp/:
# - /tmp/pentest_analysis.json
# - /tmp/pentest_referrer-leak_test.sh
# - /tmp/pentest_report_referrer-leak.md
```

## Test Script Templates

### CSRF Test
- POST request without CSRF token
- SameSite cookie policy check
- Form submission validation

### XSS Test
- Multiple XSS payload variants
- Reflected XSS detection
- Response analysis

### Referrer Leak Test
- Referrer header transmission check
- Referrer-Policy header inspection
- Session token leakage detection

### SQL Injection Test
- Basic SQL injection payloads
- Error-based detection
- Response analysis

### Auth Bypass Test
- Direct resource access attempts
- Authentication mechanism validation

## Report Templates

### CSRF Report
- Vulnerability description
- Impact: Unauthorized user actions
- Reproduction steps
- Mitigation: CSRF tokens, SameSite cookies

### Referrer Leak Report
- Session token exposure details
- Impact: Session hijacking, GDPR violations
- Reproduction steps
- Mitigation: Referrer-Policy headers

### Custom Report
- Generic vulnerability template
- Customizable fields
- Interactive mode available

## Report Structure

All generated reports follow this structure:

```markdown
# HackerOne Bug Bounty Report

## [Vulnerability Title]

**Program:** [Program Name]
**Severity:** [LOW/MEDIUM/HIGH/CRITICAL]
**Date:** [Date]
**Template:** [Template Type]

---

## Summary
[Vulnerability description]

## Impact Assessment
[Impact details and risk]

## Reproduction Steps
[Step-by-step reproduction]

## Proof of Concept
[PoC code and evidence]

## Recommended Mitigation
[Remediation recommendations]

## References
- OWASP Testing Guide
- HackerOne Disclosure Guidelines

---

**Researcher Notes:**
[Additional context]

**Disclosure Timeline:**
- Discovery: [Date]
- Initial Report: [Date]
```

## Security Considerations

### ‚ö†Ô∏è Important Warnings

1. **Authorization Required**: Only test systems you have explicit permission to test
2. **Responsible Disclosure**: Follow HackerOne's disclosure guidelines
3. **No Automated Attacks**: Review scripts before execution
4. **Data Privacy**: Do not access or modify user data without authorization
5. **Scope Compliance**: Stay within the program's defined scope

### Best Practices

- **Read Program Guidelines**: Always review scope before testing
- **Document Everything**: Keep detailed records of findings
- **Test Responsibly**: Avoid DoS, excessive requests, or destructive actions
- **Report Promptly**: Submit findings through proper channels
- **Follow Up**: Respond to program team communications

## Advanced Usage

### Using HackerOne API

Set your API token for full functionality:

```bash
export HACKERONE_API_TOKEN="your_token_here"
```

### Customizing Templates

Edit the pentest command:

```bash
mcli commands edit pentest
```

Modify template functions:
- `get_csrf_report_template()`
- `get_referrer_leak_template()`
- `generate_csrf_test()`
- etc.

### Integration with Existing Scripts

You can integrate your existing bash scripts from the resources you provided:

```bash
# Add custom test generators
# Edit pentest.json and add new functions
```

## Troubleshooting

### Command Not Found

If `mcli workflow pentest` doesn't work:

```bash
# Verify installation
mcli commands list-custom | grep pentest

# Reload commands
# Restart shell or run:
hash -r
```

### Missing Dependencies

```bash
# Install required packages
pip install requests beautifulsoup4

# Or with uv:
uv pip install requests beautifulsoup4
```

### Permission Issues

```bash
# Ensure scripts are executable
chmod +x /tmp/pentest_*.sh
```

## File Locations

- **Command Definition**: `~/.mcli/commands/pentest.json`
- **Generated Tests**: `/tmp/pentest_*_test.sh` (or specified output)
- **Generated Reports**: `/tmp/pentest_report_*.md` (or specified output)
- **Analysis Data**: `/tmp/pentest_analysis.json`

## Command Reference

### discover
```
mcli workflow pentest discover [OPTIONS]

Options:
  --limit INTEGER      Number of programs to fetch (default: 20)
  --output, -o PATH    Save results to JSON file
  --filter, -f TEXT    Filter by program name
```

### analyze
```
mcli workflow pentest analyze PROGRAM_URL [OPTIONS]

Arguments:
  PROGRAM_URL          HackerOne program URL

Options:
  --output, -o PATH    Save analysis to file
```

### generate-test
```
mcli workflow pentest generate-test [OPTIONS]

Options:
  --vuln-type, -t      Vulnerability type (csrf|xss|referrer-leak|sql-injection|auth-bypass)
  --target, -u TEXT    Target URL or identifier [required]
  --output, -o PATH    Output script file
```

### report
```
mcli workflow pentest report [OPTIONS]

Options:
  --template, -t       Report template (csrf|xss|referrer-leak|custom)
  --title TEXT         Vulnerability title [required]
  --severity           Severity level (low|medium|high|critical)
  --program TEXT       Program name
  --output, -o PATH    Output file
  --interactive, -i    Interactive mode
```

### workflow
```
mcli workflow pentest workflow PROGRAM_URL [OPTIONS]

Arguments:
  PROGRAM_URL          HackerOne program URL

Options:
  --vuln-type, -t      Vulnerability type to test [required]
  --execute, -e        Execute generated test script
```

### list-templates
```
mcli workflow pentest list-templates

Lists all available test and report templates.
```

## Examples from Your Research

### Example 1: Referrer Header Leakage (Google Forms)

```bash
# Generate test based on your research
mcli workflow pentest generate-test \
  -t referrer-leak \
  -u "https://docs.google.com/forms/d/e/1FAIpQLScboEaIRlmfQ9y8cuJmtWVkZLo7ywWaB11fpzZXZJY4TSCS4g/viewform" \
  -o referrer_h1_google_forms.sh

# The script will test:
# 1. Referrer header transmission
# 2. Referrer-Policy header presence
# 3. Session token leakage potential
```

### Example 2: Authenticated CSRF Testing

```bash
# Generate CSRF test
mcli workflow pentest generate-test \
  -t csrf \
  -u "https://target.com/submit" \
  -o authenticated_csrf_test.sh

# Manually add authentication cookies to the generated script
# Then execute
bash authenticated_csrf_test.sh
```

## Contributing

To add new vulnerability types or improve templates:

1. Edit the command: `mcli commands edit pentest`
2. Add new test generator functions
3. Add new report templates
4. Update the vulnerability type choices in command options

## Version History

- **v2.0** (2025-10-29): Complete HackerOne pentest workflow
  - Program discovery
  - Scope analysis
  - 5 vulnerability test types
  - Professional report generation
  - End-to-end automation

## License

Part of MCLI Framework. Use responsibly for authorized security testing only.

## Support

For issues or feature requests:
- File an issue with the MCLI repository
- Use `mcli commands info pentest` for command details
- Check logs with `mcli logs tail`
